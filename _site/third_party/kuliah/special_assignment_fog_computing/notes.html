<h1 id="setting-up-kubernetes">Setting up kubernetes</h1>
<p>tutorial: https://kubecloud.io/setting-up-a-kubernetes-1-11-raspberry-pi-cluster-using-kubeadm-952bbda329c8</p>

<h3 id="disable-swap-on-ubuntu">Disable swap on Ubuntu</h3>
<p>This Intel Fog Computing Reference uses Ubuntu.
How to disable swap:</p>
<ul>
  <li>https://docs.platform9.com/support/disabling-swap-kubernetes-node/</li>
  <li>https://unix.stackexchange.com/questions/224156/how-to-safely-turn-off-swap-permanently-and-reclaim-the-space-on-debian-jessie</li>
</ul>

<h3 id="dont-forget-to-read-and-do-this-after-kubeadm-init-on-master">Don’t forget to read and do this after “kubeadm init” on master</h3>

<p>Do the following lines spitted by <code class="highlighter-rouge">kubeadm init</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join IP_ADDRESS:6443 --token TOKEN --discovery-token-ca-cert-hash sha256:HASH
</code></pre></div></div>

<h3 id="how-to-leave-node">How to leave node</h3>
<p>on master:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl drain node-name
kubectl delete node node-name
</code></pre></div></div>
<p>on the node:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo kubeadm reset
</code></pre></div></div>

<h2 id="how-to-label-nodes">How to label nodes</h2>
<p>Tutorial: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/</p>

<p>For example, a node named <code class="highlighter-rouge">blackraspi</code> is about to be labeled <code class="highlighter-rouge">machinetype=raspi</code>. Command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl label node blackraspi machinetype=raspi
# to see the labels of the nodes
kubectl get nodes --show-labels
</code></pre></div></div>

<h2 id="deployment">Deployment</h2>
<p>Command:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create -f deployment.yaml
</code></pre></div></div>
<h3 id="how-to-set-where-the-pod-lands-with-node-label-selector">How to set where the pod lands with node label selector:</h3>
<p>Example:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="s">...</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">...</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">...</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">nodeSelector</span><span class="pi">:</span> <span class="c1"># see this for node selector</span>
        <span class="na">machinetype</span><span class="pi">:</span> <span class="s">raspi</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">...</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">...</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="s">...</span>
</code></pre></div></div>

